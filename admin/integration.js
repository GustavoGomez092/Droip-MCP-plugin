/**
 * Droip Claude Bridge — Integration Tab Injection
 *
 * Injects a "Claude Code (MCP)" card into the Droip Integrations tab.
 * The card has a Configure button that opens a modal with the MCP config JSON.
 */
(function () {
	var CARD_ID = "dcb-integration-card";
	var MODAL_ID = "dcb-modal";
	var BACKDROP_ID = "dcb-backdrop";

	// SVG logo for Claude
	var LOGO_SVG =
		'<svg style="width:60px; height:60px;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="48px" height="48px" viewBox="0 0 48 48" version="1.1">' +
		'<g id="surface1">' +
		'<path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 0 0 L 48 0 L 48 9.925781 C 47.941406 9.746094 47.859375 9.570312 47.824219 9.378906 C 47.765625 9.09375 47.832031 8.796875 47.726562 8.519531 C 47.59375 8.15625 47.550781 7.765625 47.394531 7.414062 C 47.160156 6.753906 46.867188 6.121094 46.519531 5.515625 C 46.253906 5.070312 45.949219 4.648438 45.644531 4.230469 C 45.316406 3.796875 44.910156 3.433594 44.535156 3.046875 C 44.15625 2.648438 43.699219 2.347656 43.269531 2.015625 C 42.90625 1.761719 42.535156 1.515625 42.132812 1.328125 C 41.738281 1.152344 41.351562 0.949219 40.9375 0.816406 C 40.546875 0.664062 40.148438 0.523438 39.738281 0.4375 C 39.289062 0.347656 38.84375 0.207031 38.382812 0.207031 C 38.113281 0.183594 37.84375 0.164062 37.574219 0.152344 C 37.207031 0.101562 36.835938 0.125 36.46875 0.121094 C 28.125 0.121094 19.78125 0.121094 11.4375 0.121094 C 11.191406 0.125 10.949219 0.0429688 10.707031 0.0898438 C 10.128906 0.222656 9.53125 0.148438 8.957031 0.28125 C 8.351562 0.425781 7.738281 0.539062 7.164062 0.777344 C 6.707031 0.925781 6.273438 1.144531 5.835938 1.339844 C 5.464844 1.519531 5.128906 1.753906 4.78125 1.96875 C 3.820312 2.566406 3.003906 3.378906 2.289062 4.25 C 1.464844 5.292969 0.855469 6.492188 0.441406 7.753906 C 0.390625 7.980469 0.335938 8.203125 0.253906 8.421875 C 0.136719 8.738281 0.242188 9.121094 0 9.390625 Z M 0 0 "/>' +
		'<path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 33.363281 10.128906 C 33.640625 10 33.953125 10.078125 34.246094 10.054688 C 34.234375 12.3125 34.25 14.570312 34.242188 16.832031 C 34.242188 17.015625 34.195312 17.203125 34.199219 17.386719 C 34.199219 20.65625 34.195312 23.921875 34.195312 27.1875 C 34.199219 27.375 34.152344 27.5625 34.152344 27.75 C 34.148438 27.949219 34.15625 28.148438 34.128906 28.34375 C 34.074219 28.6875 34.152344 29.046875 34.039062 29.386719 C 33.925781 29.710938 33.953125 30.074219 33.816406 30.390625 C 33.722656 30.617188 33.703125 30.859375 33.617188 31.085938 C 33.542969 31.273438 33.472656 31.460938 33.378906 31.640625 C 33.027344 32.316406 32.652344 32.988281 32.191406 33.597656 C 31.792969 34.054688 31.382812 34.507812 30.933594 34.917969 C 30.40625 35.355469 29.832031 35.738281 29.242188 36.085938 C 28.988281 36.234375 28.710938 36.332031 28.441406 36.449219 C 27.988281 36.648438 27.527344 36.84375 27.035156 36.933594 C 26.816406 36.984375 26.605469 37.078125 26.378906 37.105469 C 25.925781 37.164062 25.492188 37.332031 25.03125 37.335938 C 24.328125 37.335938 23.625 37.335938 22.921875 37.335938 C 22.546875 37.34375 22.199219 37.1875 21.832031 37.144531 C 21.613281 37.109375 21.394531 37.101562 21.179688 37.035156 C 20.894531 36.949219 20.597656 36.898438 20.324219 36.773438 C 19.882812 36.613281 19.433594 36.464844 19.015625 36.25 C 18.53125 35.996094 18.042969 35.738281 17.605469 35.40625 C 17.039062 34.96875 16.472656 34.511719 16.023438 33.945312 C 15.789062 33.644531 15.542969 33.351562 15.347656 33.023438 C 15.1875 32.765625 15.003906 32.515625 14.867188 32.242188 C 14.636719 31.804688 14.480469 31.335938 14.324219 30.871094 C 14.25 30.527344 14.09375 30.210938 14.046875 29.867188 C 14.003906 29.59375 13.886719 29.335938 13.898438 29.058594 C 13.902344 28.746094 13.835938 28.4375 13.851562 28.125 C 13.863281 27.59375 13.824219 27.058594 13.890625 26.53125 C 13.910156 26.257812 13.863281 25.976562 13.949219 25.710938 C 14.023438 25.488281 14.070312 25.261719 14.125 25.039062 C 14.304688 24.496094 14.417969 23.925781 14.707031 23.429688 C 14.925781 23.03125 15.089844 22.605469 15.34375 22.234375 C 15.605469 21.832031 15.9375 21.484375 16.242188 21.117188 C 16.589844 20.683594 17.035156 20.347656 17.464844 19.996094 C 17.914062 19.617188 18.425781 19.324219 18.945312 19.050781 C 19.332031 18.890625 19.6875 18.660156 20.089844 18.542969 C 20.347656 18.472656 20.597656 18.375 20.859375 18.328125 C 21.140625 18.277344 21.402344 18.144531 21.691406 18.121094 C 22.011719 18.09375 22.316406 17.976562 22.636719 17.9375 C 22.980469 17.910156 23.328125 17.949219 23.671875 17.90625 C 23.90625 17.875 24.140625 17.886719 24.375 17.886719 C 25.796875 17.886719 27.21875 17.886719 28.640625 17.886719 C 28.832031 17.890625 29.027344 17.867188 29.21875 17.90625 C 29.238281 17.078125 29.226562 16.25 29.230469 15.421875 C 29.242188 15.042969 29.300781 14.671875 29.402344 14.308594 C 29.453125 13.96875 29.605469 13.660156 29.714844 13.339844 C 29.941406 12.761719 30.277344 12.21875 30.730469 11.789062 C 30.996094 11.527344 31.238281 11.234375 31.546875 11.019531 C 31.902344 10.761719 32.304688 10.582031 32.683594 10.371094 C 32.894531 10.25 33.140625 10.226562 33.363281 10.128906 M 22.601562 21.960938 C 22.316406 21.972656 22.046875 22.078125 21.777344 22.160156 C 21.484375 22.246094 21.222656 22.40625 20.957031 22.546875 C 20.609375 22.753906 20.261719 22.96875 19.988281 23.269531 C 19.519531 23.78125 19.070312 24.339844 18.816406 24.992188 C 18.71875 25.332031 18.554688 25.65625 18.539062 26.015625 C 18.523438 26.351562 18.347656 26.660156 18.347656 27 C 18.347656 27.3125 18.34375 27.625 18.347656 27.941406 C 18.347656 28.277344 18.527344 28.585938 18.539062 28.921875 C 18.550781 29.273438 18.722656 29.589844 18.847656 29.910156 C 19.074219 30.378906 19.324219 30.84375 19.652344 31.25 C 19.992188 31.6875 20.457031 31.992188 20.910156 32.296875 C 21.242188 32.527344 21.628906 32.652344 22.007812 32.789062 C 22.179688 32.84375 22.359375 32.847656 22.535156 32.878906 C 22.789062 32.917969 23.03125 33.03125 23.292969 33.027344 C 23.613281 33.023438 23.933594 33.050781 24.25 32.980469 C 24.589844 32.90625 24.941406 32.886719 25.285156 32.824219 C 25.648438 32.734375 26 32.601562 26.328125 32.429688 C 27.046875 32.101562 27.640625 31.550781 28.117188 30.929688 C 28.390625 30.59375 28.625 30.214844 28.757812 29.796875 C 28.832031 29.53125 28.976562 29.289062 29.027344 29.015625 C 29.089844 28.6875 29.238281 28.371094 29.226562 28.03125 C 29.226562 26.21875 29.230469 24.40625 29.230469 22.59375 C 29.226562 22.328125 29.261719 22.058594 29.164062 21.804688 C 29.125 21.808594 29.050781 21.816406 29.011719 21.820312 C 27.246094 21.820312 25.480469 21.8125 23.71875 21.820312 C 23.339844 21.808594 22.976562 21.945312 22.601562 21.960938 Z M 22.601562 21.960938 "/>' +
		'<path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 47.839844 38.59375 C 47.871094 38.453125 47.941406 38.328125 48 38.199219 L 48 48 L 0 48 L 0 38.246094 C 0.148438 38.480469 0.214844 38.761719 0.207031 39.039062 C 0.199219 39.351562 0.351562 39.636719 0.414062 39.941406 C 0.484375 40.316406 0.644531 40.667969 0.777344 41.023438 C 0.953125 41.511719 1.207031 41.964844 1.449219 42.421875 C 1.71875 42.902344 2.050781 43.347656 2.378906 43.792969 C 2.917969 44.4375 3.507812 45.046875 4.175781 45.558594 C 4.496094 45.785156 4.789062 46.046875 5.136719 46.234375 C 5.390625 46.367188 5.621094 46.535156 5.871094 46.667969 C 6.273438 46.863281 6.679688 47.054688 7.105469 47.1875 C 7.484375 47.335938 7.871094 47.464844 8.269531 47.550781 C 8.648438 47.632812 9.023438 47.753906 9.410156 47.785156 C 9.792969 47.796875 10.175781 47.820312 10.554688 47.882812 C 10.785156 47.914062 11.019531 47.878906 11.25 47.878906 C 19.421875 47.878906 27.59375 47.878906 35.765625 47.878906 C 36.230469 47.890625 36.695312 47.851562 37.15625 47.910156 C 37.367188 47.925781 37.574219 47.847656 37.78125 47.839844 C 38.015625 47.824219 38.246094 47.796875 38.476562 47.789062 C 38.769531 47.785156 39.054688 47.703125 39.339844 47.640625 C 39.578125 47.585938 39.820312 47.535156 40.054688 47.46875 C 40.910156 47.25 41.714844 46.878906 42.492188 46.476562 C 44.042969 45.550781 45.414062 44.289062 46.355469 42.746094 C 46.574219 42.394531 46.757812 42.019531 46.953125 41.65625 C 47.15625 41.269531 47.285156 40.851562 47.4375 40.441406 C 47.5625 40.128906 47.609375 39.792969 47.71875 39.472656 C 47.824219 39.1875 47.773438 38.882812 47.839844 38.59375 Z M 47.839844 38.59375 "/>' +
		'<path style=" stroke:none;fill-rule:nonzero;fill:rgb(83.529413%,46.27451%,33.333334%);fill-opacity:1;" d="M 8.957031 0.28125 C 9.53125 0.148438 10.128906 0.222656 10.707031 0.0898438 C 10.949219 0.0429688 11.191406 0.125 11.4375 0.121094 C 19.78125 0.121094 28.125 0.121094 36.46875 0.121094 C 36.835938 0.125 37.207031 0.101562 37.574219 0.152344 C 37.84375 0.164062 38.113281 0.183594 38.382812 0.207031 C 38.84375 0.207031 39.289062 0.347656 39.738281 0.4375 C 40.148438 0.523438 40.546875 0.664062 40.9375 0.816406 C 41.351562 0.949219 41.738281 1.152344 42.132812 1.328125 C 42.535156 1.515625 42.90625 1.761719 43.269531 2.015625 C 43.699219 2.347656 44.15625 2.648438 44.535156 3.046875 C 44.910156 3.433594 45.316406 3.796875 45.644531 4.230469 C 45.949219 4.648438 46.253906 5.070312 46.519531 5.515625 C 46.867188 6.121094 47.160156 6.753906 47.394531 7.414062 C 47.550781 7.765625 47.59375 8.15625 47.726562 8.519531 C 47.832031 8.796875 47.765625 9.09375 47.824219 9.378906 C 47.859375 9.570312 47.941406 9.746094 48 9.925781 L 48 38.199219 C 47.941406 38.328125 47.871094 38.453125 47.839844 38.59375 C 47.773438 38.882812 47.824219 39.1875 47.71875 39.472656 C 47.609375 39.792969 47.5625 40.128906 47.4375 40.441406 C 47.285156 40.851562 47.15625 41.269531 46.953125 41.65625 C 46.757812 42.019531 46.574219 42.394531 46.355469 42.746094 C 45.414062 44.289062 44.042969 45.550781 42.492188 46.476562 C 41.714844 46.878906 40.910156 47.25 40.054688 47.46875 C 39.820312 47.535156 39.578125 47.585938 39.339844 47.640625 C 39.054688 47.703125 38.769531 47.785156 38.476562 47.789062 C 38.246094 47.796875 38.015625 47.824219 37.78125 47.839844 C 37.574219 47.847656 37.367188 47.925781 37.15625 47.910156 C 36.695312 47.851562 36.230469 47.890625 35.765625 47.878906 C 27.59375 47.878906 19.421875 47.878906 11.25 47.878906 C 11.019531 47.878906 10.785156 47.914062 10.554688 47.882812 C 10.175781 47.820312 9.792969 47.796875 9.410156 47.785156 C 9.023438 47.753906 8.648438 47.632812 8.269531 47.550781 C 7.871094 47.464844 7.484375 47.335938 7.105469 47.1875 C 6.679688 47.054688 6.273438 46.863281 5.871094 46.667969 C 5.621094 46.535156 5.390625 46.367188 5.136719 46.234375 C 4.789062 46.046875 4.496094 45.785156 4.175781 45.558594 C 3.507812 45.046875 2.917969 44.4375 2.378906 43.792969 C 2.050781 43.347656 1.71875 42.902344 1.449219 42.421875 C 1.207031 41.964844 0.953125 41.511719 0.777344 41.023438 C 0.644531 40.667969 0.484375 40.316406 0.414062 39.941406 C 0.351562 39.636719 0.199219 39.351562 0.207031 39.039062 C 0.214844 38.761719 0.148438 38.480469 0 38.246094 L 0 9.390625 C 0.242188 9.121094 0.136719 8.738281 0.253906 8.421875 C 0.335938 8.203125 0.390625 7.980469 0.441406 7.753906 C 0.855469 6.492188 1.464844 5.292969 2.289062 4.25 C 3.003906 3.378906 3.820312 2.566406 4.78125 1.96875 C 5.128906 1.753906 5.464844 1.519531 5.835938 1.339844 C 6.273438 1.144531 6.707031 0.925781 7.164062 0.777344 C 7.738281 0.539062 8.351562 0.425781 8.957031 0.28125 M 33.363281 10.128906 C 33.140625 10.226562 32.894531 10.25 32.683594 10.371094 C 32.304688 10.582031 31.902344 10.761719 31.546875 11.019531 C 31.238281 11.234375 30.996094 11.527344 30.730469 11.789062 C 30.277344 12.21875 29.941406 12.761719 29.714844 13.339844 C 29.605469 13.660156 29.453125 13.96875 29.402344 14.308594 C 29.300781 14.671875 29.242188 15.042969 29.230469 15.421875 C 29.226562 16.25 29.238281 17.078125 29.21875 17.90625 C 29.027344 17.867188 28.832031 17.890625 28.640625 17.886719 C 27.21875 17.886719 25.796875 17.886719 24.375 17.886719 C 24.140625 17.886719 23.90625 17.875 23.671875 17.90625 C 23.328125 17.949219 22.980469 17.910156 22.636719 17.9375 C 22.316406 17.976562 22.011719 18.09375 21.691406 18.121094 C 21.402344 18.144531 21.140625 18.277344 20.859375 18.328125 C 20.597656 18.375 20.347656 18.472656 20.089844 18.542969 C 19.6875 18.660156 19.332031 18.890625 18.945312 19.050781 C 18.425781 19.324219 17.914062 19.617188 17.464844 19.996094 C 17.035156 20.347656 16.589844 20.683594 16.242188 21.117188 C 15.9375 21.484375 15.605469 21.832031 15.34375 22.234375 C 15.089844 22.605469 14.925781 23.03125 14.707031 23.429688 C 14.417969 23.925781 14.304688 24.496094 14.125 25.039062 C 14.070312 25.261719 14.023438 25.488281 13.949219 25.710938 C 13.863281 25.976562 13.910156 26.257812 13.890625 26.53125 C 13.824219 27.058594 13.863281 27.59375 13.851562 28.125 C 13.835938 28.4375 13.902344 28.746094 13.898438 29.058594 C 13.886719 29.335938 14.003906 29.59375 14.046875 29.867188 C 14.09375 30.210938 14.25 30.527344 14.324219 30.871094 C 14.480469 31.335938 14.636719 31.804688 14.867188 32.242188 C 15.003906 32.515625 15.1875 32.765625 15.347656 33.023438 C 15.542969 33.351562 15.789062 33.644531 16.023438 33.945312 C 16.472656 34.511719 17.039062 34.96875 17.605469 35.40625 C 18.042969 35.738281 18.53125 35.996094 19.015625 36.25 C 19.433594 36.464844 19.882812 36.613281 20.324219 36.773438 C 20.597656 36.898438 20.894531 36.949219 21.179688 37.035156 C 21.394531 37.101562 21.613281 37.109375 21.832031 37.144531 C 22.199219 37.1875 22.546875 37.34375 22.921875 37.335938 C 23.625 37.335938 24.328125 37.335938 25.03125 37.335938 C 25.492188 37.332031 25.925781 37.164062 26.378906 37.105469 C 26.605469 37.078125 26.816406 36.984375 27.035156 36.933594 C 27.527344 36.84375 27.988281 36.648438 28.441406 36.449219 C 28.710938 36.332031 28.988281 36.234375 29.242188 36.085938 C 29.832031 35.738281 30.40625 35.355469 30.933594 34.917969 C 31.382812 34.507812 31.792969 34.054688 32.191406 33.597656 C 32.652344 32.988281 33.027344 32.316406 33.378906 31.640625 C 33.472656 31.460938 33.542969 31.273438 33.617188 31.085938 C 33.703125 30.859375 33.722656 30.617188 33.816406 30.390625 C 33.953125 30.074219 33.925781 29.710938 34.039062 29.386719 C 34.152344 29.046875 34.074219 28.6875 34.128906 28.34375 C 34.15625 28.148438 34.148438 27.949219 34.152344 27.75 C 34.152344 27.5625 34.199219 27.375 34.195312 27.1875 C 34.195312 23.921875 34.199219 20.65625 34.199219 17.386719 C 34.195312 17.203125 34.242188 17.015625 34.242188 16.832031 C 34.25 14.570312 34.234375 12.3125 34.246094 10.054688 C 33.953125 10.078125 33.640625 10 33.363281 10.128906 Z M 33.363281 10.128906 "/>' +
		'<path style=" stroke:none;fill-rule:nonzero;fill:rgb(83.529413%,46.27451%,33.333334%);fill-opacity:1;" d="M 22.601562 21.960938 C 22.976562 21.945312 23.339844 21.808594 23.71875 21.820312 C 25.480469 21.8125 27.246094 21.820312 29.011719 21.820312 C 29.050781 21.816406 29.125 21.808594 29.164062 21.804688 C 29.261719 22.058594 29.226562 22.328125 29.230469 22.59375 C 29.230469 24.40625 29.226562 26.21875 29.226562 28.03125 C 29.238281 28.371094 29.089844 28.6875 29.027344 29.015625 C 28.976562 29.289062 28.832031 29.53125 28.757812 29.796875 C 28.625 30.214844 28.390625 30.59375 28.117188 30.929688 C 27.640625 31.550781 27.046875 32.101562 26.328125 32.429688 C 26 32.601562 25.648438 32.734375 25.285156 32.824219 C 24.941406 32.886719 24.589844 32.90625 24.25 32.980469 C 23.933594 33.050781 23.613281 33.023438 23.292969 33.027344 C 23.03125 33.03125 22.789062 32.917969 22.535156 32.878906 C 22.359375 32.847656 22.179688 32.84375 22.007812 32.789062 C 21.628906 32.652344 21.242188 32.527344 20.910156 32.296875 C 20.457031 31.992188 19.992188 31.6875 19.652344 31.25 C 19.324219 30.84375 19.074219 30.378906 18.847656 29.910156 C 18.722656 29.589844 18.550781 29.273438 18.539062 28.921875 C 18.527344 28.585938 18.347656 28.277344 18.347656 27.941406 C 18.34375 27.625 18.347656 27.3125 18.347656 27 C 18.347656 26.660156 18.523438 26.351562 18.539062 26.015625 C 18.554688 25.65625 18.71875 25.332031 18.816406 24.992188 C 19.070312 24.339844 19.519531 23.78125 19.988281 23.269531 C 20.261719 22.96875 20.609375 22.753906 20.957031 22.546875 C 21.222656 22.40625 21.484375 22.246094 21.777344 22.160156 C 22.046875 22.078125 22.316406 21.972656 22.601562 21.960938 Z M 22.601562 21.960938 "/>' +
		"</g>" +
		"</svg>";

	/**
	 * Build the integration card.
	 * Uses dcb- prefixed classes only (no droip-api-list) to avoid
	 * Droip's React SPA intercepting click events.
	 */
	function buildCard() {
		// Use droip-dashboard-label-wrapper for grid styling but NOT droip-api-list
		// (droip-api-list has React click handlers that swallow events)
		var wrapper = document.createElement("div");
		wrapper.id = CARD_ID;
		wrapper.className = "droip-dashboard-label-wrapper";
		wrapper.style.gridTemplateColumns = "4fr 1fr";

		// Left side: logo + details (same flex container as siblings)
		var left = document.createElement("div");
		left.style.display = "flex";
		left.style.gap = "24px";

		var logoDiv = document.createElement("div");
		logoDiv.className = "droip-api-logo";
		logoDiv.innerHTML = LOGO_SVG;
		left.appendChild(logoDiv);

		var detailsDiv = document.createElement("div");
		detailsDiv.className = "droip-api-details";

		var title = document.createElement("span");
		title.className = "droip-dashboard-label-title";
		title.style.lineHeight = "16px";
		title.style.marginBottom = "12px";
		title.textContent = "Claude Code (MCP)";
		detailsDiv.appendChild(title);

		var desc = document.createElement("div");
		desc.className = "droip-dashboard-label-text";
		desc.textContent =
			"Connect Claude Code to your Droip site via the Model Context Protocol. Lets Claude create and manage symbols, pages, and styles programmatically.";
		detailsDiv.appendChild(desc);

		left.appendChild(detailsDiv);
		wrapper.appendChild(left);

		// Right side: Configure button (same structure as siblings)
		var btnDiv = document.createElement("div");
		btnDiv.className = "droip-api-buttons droip-justify-end";

		var btn = document.createElement("div");
		btn.className = "droip-btn droip-btn-outline";
		btn.setAttribute("role", "button");
		btn.textContent = "Configure";
		btn.style.cursor = "pointer";
		btn.onclick = function (e) {
			e.preventDefault();
			e.stopPropagation();
			openModal();
		};
		btnDiv.appendChild(btn);
		wrapper.appendChild(btnDiv);

		return wrapper;
	}

	// ─── Modal ──────────────────────────────────────────────────────────────

	function openModal() {
		// Already open
		if (document.getElementById(MODAL_ID)) {
			closeModal();
			return;
		}

		showModal(droipBridge.configJson || "");
	}

	function showModal(configJson) {
		// Backdrop
		var backdrop = document.createElement("div");
		backdrop.id = BACKDROP_ID;
		backdrop.onclick = closeModal;
		document.body.appendChild(backdrop);

		// Modal
		var modal = document.createElement("div");
		modal.id = MODAL_ID;
		modal.onclick = function (e) {
			e.stopPropagation();
		};

		// Header
		var header = document.createElement("div");
		header.className = "dcb-modal-header";
		var h3 = document.createElement("h3");
		h3.textContent = "MCP Configuration";
		var closeBtn = document.createElement("button");
		closeBtn.type = "button";
		closeBtn.className = "dcb-modal-close";
		closeBtn.innerHTML = "&times;";
		closeBtn.onclick = closeModal;
		header.appendChild(h3);
		header.appendChild(closeBtn);
		modal.appendChild(header);

		// Body
		var body = document.createElement("div");
		body.className = "dcb-modal-body";

		var hint = document.createElement("p");
		hint.className = "dcb-muted";
		hint.innerHTML =
			"Add this to your <code>claude_desktop_config.json</code> or <code>.claude.json</code> to connect Claude to your Droip site.";
		body.appendChild(hint);

		var configArea = document.createElement("div");
		configArea.className = "dcb-config-area";

		var copyBtn = document.createElement("button");
		copyBtn.type = "button";
		copyBtn.className = "dcb-copy-btn";
		copyBtn.textContent = "Copy";

		var pre = document.createElement("pre");
		var code = document.createElement("code");
		code.textContent = configJson || "(Could not load config)";
		pre.appendChild(code);

		copyBtn.onclick = function () {
			var text = code.textContent;
			if (navigator.clipboard && navigator.clipboard.writeText) {
				navigator.clipboard.writeText(text).then(function () {
					showCopied(copyBtn);
				});
			} else {
				var ta = document.createElement("textarea");
				ta.value = text;
				ta.style.cssText = "position:fixed;left:-9999px;";
				document.body.appendChild(ta);
				ta.select();
				document.execCommand("copy");
				document.body.removeChild(ta);
				showCopied(copyBtn);
			}
		};

		configArea.appendChild(copyBtn);
		configArea.appendChild(pre);
		body.appendChild(configArea);
		modal.appendChild(body);

		// Footer
		var footer = document.createElement("div");
		footer.className = "dcb-modal-footer";
		var doneBtn = document.createElement("button");
		doneBtn.type = "button";
		doneBtn.className = "dcb-btn-primary";
		doneBtn.textContent = "Done";
		doneBtn.onclick = closeModal;
		footer.appendChild(doneBtn);
		modal.appendChild(footer);

		document.body.appendChild(modal);

		// Animate in
		requestAnimationFrame(function () {
			backdrop.classList.add("dcb-visible");
			modal.classList.add("dcb-visible");
		});
	}

	function closeModal() {
		var backdrop = document.getElementById(BACKDROP_ID);
		var modal = document.getElementById(MODAL_ID);
		if (backdrop) backdrop.classList.remove("dcb-visible");
		if (modal) modal.classList.remove("dcb-visible");
		setTimeout(function () {
			if (backdrop && backdrop.parentNode) backdrop.remove();
			if (modal && modal.parentNode) modal.remove();
		}, 200);
	}

	function showCopied(btn) {
		btn.textContent = "Copied!";
		btn.classList.add("dcb-copied");
		setTimeout(function () {
			btn.textContent = "Copy";
			btn.classList.remove("dcb-copied");
		}, 2000);
	}

	// ─── Styles ─────────────────────────────────────────────────────────────

	function injectStyles() {
		var s = document.createElement("style");
		s.textContent = [
			/* Backdrop */
			"#" + BACKDROP_ID + "{position:fixed;inset:0;background:rgba(0,0,0,0.35);z-index:100000;opacity:0;transition:opacity .2s;}",
			"#" + BACKDROP_ID + ".dcb-visible{opacity:1;}",

			/* Modal */
			"#" + MODAL_ID + "{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0.95);width:540px;max-width:90vw;max-height:85vh;" +
				"background:#fff;z-index:100001;border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,0.2);opacity:0;transition:opacity .2s,transform .2s;display:flex;flex-direction:column;}",
			"#" + MODAL_ID + ".dcb-visible{opacity:1;transform:translate(-50%,-50%) scale(1);}",
			".dcb-modal-header{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:1px solid #e5e7eb;flex-shrink:0;}",
			".dcb-modal-header h3{margin:0;font-size:16px;font-weight:600;}",
			".dcb-modal-close{background:none;border:none;font-size:24px;cursor:pointer;color:#666;padding:0;line-height:1;}",
			".dcb-modal-body{padding:24px;overflow-y:auto;}",
			".dcb-modal-footer{padding:16px 24px;border-top:1px solid #e5e7eb;display:flex;justify-content:flex-end;flex-shrink:0;}",
			".dcb-btn-primary{background:#2271b1;color:#fff;border:none;border-radius:6px;padding:8px 20px;cursor:pointer;font-size:13px;font-weight:500;transition:background .15s;}",
			".dcb-btn-primary:hover{background:#135e96;}",
			".dcb-muted{color:#646970;font-size:13px;margin:0 0 4px;line-height:1.5;}",
			".dcb-muted code{background:#f0f0f1;padding:1px 5px;border-radius:3px;font-size:11px;}",

			/* Config area */
			".dcb-config-area{position:relative;margin-top:16px;}",
			".dcb-config-area pre{background:#1e1e1e;color:#d4d4d4;padding:16px;border-radius:8px;overflow-x:auto;font-size:12px;line-height:1.5;margin:0;white-space:pre-wrap;word-break:break-all;}",
			".dcb-copy-btn{position:absolute;top:8px;right:8px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);" +
				"color:#d4d4d4;padding:4px 12px;border-radius:4px;cursor:pointer;font-size:11px;transition:all .15s;}",
			".dcb-copy-btn:hover{background:rgba(255,255,255,0.2);}",
			".dcb-copied{background:#2e7d32!important;border-color:#2e7d32!important;color:#fff!important;}",
		].join("\n");
		document.head.appendChild(s);
	}

	// ─── Injection ──────────────────────────────────────────────────────────

	function tryInject() {
		if (document.getElementById(CARD_ID)) return true;

		// Find Droip's native integration cards to insert after
		var apiLists = document.querySelectorAll(".droip-api-list");
		if (apiLists.length === 0) return false;

		var lastCard = apiLists[apiLists.length - 1];
		var card = buildCard();
		lastCard.parentNode.insertBefore(card, lastCard.nextSibling);
		return true;
	}

	function watchForIntegrations() {
		tryInject();

		var observer = new MutationObserver(function () {
			tryInject();
		});

		var target = document.getElementById("droip-app");
		if (target) {
			observer.observe(target, { childList: true, subtree: true });
		} else {
			observer.observe(document.body, { childList: true, subtree: true });
		}
	}

	// ─── Init ───────────────────────────────────────────────────────────────

	injectStyles();

	if (document.readyState === "loading") {
		document.addEventListener("DOMContentLoaded", watchForIntegrations);
	} else {
		watchForIntegrations();
	}
})();
